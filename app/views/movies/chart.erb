<div class="container">
    <br>
    <div class="header">Movies</div>
</div>

<script type="text/javascript" charset="utf-8">
  $(function() {
    new Highcharts.Chart({
        chart: {
            renderTo: "movies_chart",
            defaultSeriesType: 'spline',
            backgroundColor: "#eeeeee"
        },
        tooltip: {
            formatter: function() {
                return 'Predstavenie <b>'+ this.series.name +'</b><br>Čas pred predstavením <b>'
                        + this.x +'h</b><br>Obsadenosť <b>'+ this.y +'%</b>';
        }
        },
        title: {
            text: "Obsadenosť kinosál podľa času pred predstavením"
        },
        plotOptions: {
            spline: {
                lineWidth: 4,
                states: {
                    hover: {
                        lineWidth: 5
                    }
                },
                marker: {
                    enabled: false,
                    states: {
                        hover: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 5,
                            lineWidth: 1
                        }
                    }
                }
            }
        },
        xAxis: {
            type: "number",
            title: {
                text: "Cas pred predstavenim (h)"
            }
        },
        yAxis: {
            title: {
                text: "Naplnenost (%)"
            }
        },
        series: [
		{
            name: "<%= Movie.get_movie_name_by_id(@first.id) %>",
            data: [
            <% Screening.get_percent_filling_by_movie_id(@first.id).each do |vec| %>
                [
				<%= vec.time_before_screening.to_f %>
				<%= "," %>
                <%= (((vec.attributes["obsadenost"].to_f) * 10**2).round / (10**2).to_f)*100 %>
				]
				<%= "," %>
            <%end%>
            ]
        },
        {
            name: "<%= Movie.get_movie_name_by_id(@second.id) %>",
            data: [
            <% Screening.get_percent_filling_by_movie_id(@second.id).each do |vec| %>
                [
				<%= vec.time_before_screening.to_f %>
				<%= "," %>
				<%= (((vec.attributes["obsadenost"].to_f) * 10**2).round / (10**2).to_f)*100 %>
				]
				<%= "," %>
            <%end%>
            ]
        }
		]
    });
  });
</script>
<div id="movies_chart" class="movies_chart" style="width:600px; height:400px;"></div>

<table class="container">
  <tr>
    <th>Name</th>
    <th>First movie</th>
    <th>Second movie</th>
  </tr>

<% @movies.each do |movie| %>
  <tr>
    <td><%= movie.name %></td>
    <td><%= link_to 'Add first', chart_movies_path(:first => movie.id, :second => @second.id) %></td>
    <td><%= link_to 'Add second', chart_movies_path(:first => @first.id, :second => movie.id) %></td>
  </tr>
<% end %>
</table>
<%= link_to chart_movies_path(:first => 3, :second => 4), chart_movies_path(:first => 3, :second => 4) %>
